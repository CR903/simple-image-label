function $parcel$defineInteropFlag(e){Object.defineProperty(e,"__esModule",{value:!0,configurable:!0})}function $parcel$export(e,t,i,a){Object.defineProperty(e,t,{get:i,set:a,enumerable:!0,configurable:!0})}function $4f8e5fb2dc7a6f8f$export$b7d58db314e0ac27(e){let t=Array.isArray(e)?[]:{};if(e&&"object"==typeof e)for(let i in e)e.hasOwnProperty(i)&&(e[i]&&e[i],t[i]=e[i]);return t}function $4f8e5fb2dc7a6f8f$export$31b40729666a4ae0(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[8]=e[13]=e[18]=e[23]="-",e.join("")}function $4f8e5fb2dc7a6f8f$export$248d38f6296296c5(e,t){if("object"!=typeof e||"object"!=typeof t)return e===t;for(let i in e)if(e.hasOwnProperty(i)&&e[i]!==t[i])return!1;return!0}function $4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(e){return e.indexOf("%")>-1?+e.replace("%","")/100:e.indexOf("px")>-1?+e.replace("px","")/100:void 0}function $4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(e){return 100*e+"%"}function $4f8e5fb2dc7a6f8f$export$2176b0e68c10508f(e){return new Promise(((t,i)=>{const a=new Image;a.src=e,a.onload=()=>{t({width:a.width,height:a.height})}}))}require("./simpleImageLabel.css"),$parcel$defineInteropFlag(module.exports),$parcel$export(module.exports,"default",(()=>$5bbdaa7df4002674$export$2e2bcd8739ae039));class $5bbdaa7df4002674$var$SimpleImageLabel{constructor(e){this.imageLabelAreaEl=document.getElementById(e.el||"imageLabelArea"),this.imageUrl=e.imageUrl,this.labels=e.labels||[],this.isMouseDown=!1,this.resizeDotClasses=["n","s","w","e","nw","ne","sw","se"],this.resizeDotName=null,this.labelItemTemp=null,this.startPointTemp=null,this.divLeft=null,this.divTop=null,this.labelsContainer=null,this.defaultZIndex=0,this.$w=0,this.$h=0,this.activeUuid=null,this.error=e.error,this.contextmenu=e.contextmenu,this.imageInfo=null,this.labelClick=e.labelClick,this.init()}init(){this.imageInfo=null,this.labelsContainer||(this.imageLabelAreaEl.innerHTML=`\n            <div class="__simple-image-label__">\n                <div class="s-image-content">\n                    <img id="label-bg_img" src="${this.imageUrl}">\n                    <div id="labelsContainer" class="label-content"></div>\n                </div>\n            </div>\n        `);const e=document.getElementById("label-bg_img");e.src!==this.imageUrl&&(e.src=this.imageUrl),e.onload=()=>{this.labelAreaEvent(),this.resizeImage()},e.onerror=e=>{this.error(e)},this.labelsContainer=document.getElementById("labelsContainer"),this.initLabelElement()}resizeImage(){const e=()=>{const{width:e}=this.imageInfo,t=this.imageLabelAreaEl.querySelector(".__simple-image-label__");this.imageLabelAreaEl.clientWidth>=e?t.style.width=e/this.imageLabelAreaEl.clientWidth*100+"%":t.style.width="100%",this.$w=this.labelsContainer.clientWidth,this.$h=this.labelsContainer.clientHeight};this.imageInfo?e():$4f8e5fb2dc7a6f8f$export$2176b0e68c10508f(this.imageUrl).then((t=>{this.imageInfo=t,e()}))}initLabelElement(){this.labels.forEach((e=>{e.uuid||(e.uuid=$4f8e5fb2dc7a6f8f$export$31b40729666a4ae0()),this.createLabelElement(e)}))}labelAreaEvent(){this.$w=this.labelsContainer.clientWidth,this.$h=this.labelsContainer.clientHeight;let e={x:0,y:0},t={x:0,y:0},i={uuid:"",x:0,y:0,width:0,height:0,name:"",color:""};this.labelsContainer.onmousedown=a=>{if(0!==a.button)return;if(this.isMouseDown=!0,a.target.className.includes("label-item"))return this.clearAllLabelActive(),this.setLabelActive(a.target.id),void this.dragListen(a.target.id);if(a.target.className.includes("resize-dot"))return i=this.getLabelByUuid(a.target.parentNode.id),this.labelItemTemp=$4f8e5fb2dc7a6f8f$export$b7d58db314e0ac27(i),t={x:this.labelItemTemp.x+this.labelItemTemp.width,y:this.labelItemTemp.y+this.labelItemTemp.height},void(this.resizeDotName=this.getLabelDot(a));const l=a.clientX-this.getLabelsContainerRelativePoints().x,s=a.clientY-this.getLabelsContainerRelativePoints().y;let n=l/this.$w,o=s/this.$h;e={x:n,y:o},this.startPointTemp||(this.startPointTemp=$4f8e5fb2dc7a6f8f$export$b7d58db314e0ac27(e)),i.uuid=$4f8e5fb2dc7a6f8f$export$31b40729666a4ae0(),i.x=n,i.y=o,i.width=0,i.height=0,this.createLabelElement(i)},this.labelsContainer.onmousemove=a=>{if(a.target.className.includes("label-item")){const e=a.target.id;this.isMouseDown||this.mouseEnterLabel(e),this.dragListen(e)}const l=a.clientX-this.getLabelsContainerRelativePoints().x,s=a.clientY-this.getLabelsContainerRelativePoints().y;let n=l/this.$w,o=s/this.$h;t={x:n,y:o},i.uuid&&this.calc(i,e,t)},this.labelsContainer.onmouseup=a=>{const l=a.clientX-this.getLabelsContainerRelativePoints().x,s=a.clientY-this.getLabelsContainerRelativePoints().y;let n=l/this.$w,o=s/this.$h;t={x:n,y:o},this.calc(i,e,t),$4f8e5fb2dc7a6f8f$export$248d38f6296296c5(e,t)&&this.removeLabelByUuid(i.uuid),i={},this.isMouseDown=!1,this.resizeDotName=null,this.labelItemTemp=null},this.labelsContainer.oncontextmenu=e=>{e.preventDefault(),this.contextmenu(e)},window.addEventListener("resize",(e=>{this.$w=this.labelsContainer.clientWidth,this.$h=this.labelsContainer.clientHeight,this.resizeImage()}))}getLabelsContainerRelativePoints(){const e=document.body.clientWidth,t=document.body.clientHeight;return{x:(e-this.labelsContainer.clientWidth)/2,y:(t-this.labelsContainer.clientHeight)/2}}createLabelElement(e){const{x:t,y:i,width:a,height:l,uuid:s,color:n,name:o}=e;this.clearAllLabelActive();const d=document.createElement("div");d.className="label-item",d.id=s,d.style.left=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(t),d.style.top=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(i),d.style.width=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a),d.style.height=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(l),d.style.position="absolute",d.style.border="1px solid rgb(58,238,121)",d.style.backgroundColor="rgba(191,191,191,.5)",d.style.zIndex=this.labels.length,n&&(d.style.borderColor=n),this.resizeDotClasses.forEach((e=>{const t=document.createElement("div");t.className=`resize-dot resize-dot-${e}`,d.appendChild(t)}));const r=document.createElement("div");r.className="label-text",r.innerText=o,o&&(r.style.display="block"),d.appendChild(r),this.labelsContainer.appendChild(d)}calc(e,t,i){$4f8e5fb2dc7a6f8f$export$248d38f6296296c5(t,i)||(e.width=i.x-t.x,e.height=i.y-t.y,e.uuid&&!this.getLabelByUuid(e.uuid)?this.labels.push(e):this.changeLabelSize(e,i))}changeLabelSize(e,t){const i=document.getElementById(e.uuid);if(!i)return;const a=e.x,l=e.y,s=e.width,n=e.height,o=e.uuid,d=Math.abs(s),r=Math.abs(n);if(this.resizeDotName){const s=this.labelItemTemp.y+this.labelItemTemp.height;if(this.resizeDotName.includes("n")){const e=this.labelItemTemp.y-t.y,a=e>0?this.labelItemTemp.height+Math.abs(e):this.labelItemTemp.height-Math.abs(e),l=t.y>=s?s:t.y;i.style.top=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(l),i.style.height=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a<0?0:a)}if(this.resizeDotName.includes("s")){const e=t.y-l;i.style.height=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(e<=0?0:e)}if(this.resizeDotName.includes("w")){const e=this.labelItemTemp.x+this.labelItemTemp.width-t.x<=0?this.labelItemTemp.x+this.labelItemTemp.width:t.x;i.style.left=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(e);const a=this.labelItemTemp.x-t.x<0?this.labelItemTemp.width-Math.abs(this.labelItemTemp.x-t.x):this.labelItemTemp.width+Math.abs(this.labelItemTemp.x-t.x);i.style.width=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a<=0?0:a)}this.resizeDotName.includes("e")&&(i.style.width=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a<=0?t.x:t.x-a),e.width=a<=0?t.x:t.x-a)}else i.style.width=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(s<=0?0:d),i.style.height=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(n<=0?0:r),i.style.left=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a),i.style.top=$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(l);const f={x:$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(i.style.left),y:$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(i.style.top),height:$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(i.style.height),width:$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(i.style.width)};this.setLabelByUuid(o,f)}getLabelByUuid(e){return this.labels.find((t=>t.uuid===e))}setLabelByUuid(e,t={}){const i=document.getElementById(e);if(!i)return;const a=Object.keys(t);this.labels.forEach((l=>{l.uuid===e&&a.forEach((e=>{Object.hasOwn(l,e)&&(l[e]=t[e],l.name&&(i.querySelector(".label-text").style.display="block"),l.color&&(i.style.borderColor=l.color))}))}))}removeLabelByUuid(e){const t=document.getElementById(e);this.labels=Object.assign([],this.labels.filter((t=>t.uuid!==e))),t&&t.parentNode.removeChild(t)}removeAllLabels(){document.querySelectorAll(".label-item").forEach((e=>{e.parentNode.removeChild(e)})),this.labels=[]}clearAllLabelActive(){const e=document.querySelectorAll(".label-item");e.length&&e.forEach((e=>{e.classList.remove("label-item-active")}))}setLabelActive(e){const t=document.getElementById(e);t&&(t.classList.add("label-item-active"),this.labelClick(this.getLabelByUuid(e)))}getLabelDot(e){const t=e.target.className.replace("resize-dot resize-dot-","");return this.clearAllLabelActive(),this.setLabelActive(e.target.parentNode.id),t}mouseEnterLabel(e){const t=document.getElementById(e);t&&(t.style.cursor="default")}dragListen(e){const t=document.getElementById(e);t&&(t.onmousedown=e=>this.dragStart(e),t.onmousemove=e=>this.dragLabel(e),t.onmouseup=e=>this.dragEnd(e))}dragStart(e){const t=document.getElementById(e.target.id);t&&(t.style.cursor="move",this.divLeft=e.pageX-t.offsetLeft,this.divTop=e.pageY-t.offsetTop,this.defaultZIndex=t.style.zIndex,t.style.zIndex=100)}dragLabel(e){if(e.preventDefault(),!this.divLeft||!this.divTop)return;const t=document.getElementById(e.target.id);if(!t)return;if("default"===t.style.cursor)return;const i=1-(t.style.width?$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(t.style.width):0),a=1-(t.style.height?$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(t.style.height):0),l=e.pageX-this.divLeft,s=e.pageY-this.divTop;t.style.left=l/this.$w<=0?0:l/this.$w>=i?$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(i):$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(l/this.$w),t.style.top=s/this.$h<=0?0:s/this.$h>=a?$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(a):$4f8e5fb2dc7a6f8f$export$42dea53aa0f06782(s/this.$h)}dragEnd(e){const t=document.getElementById(e.target.id);t&&(t.style.cursor="default",this.labels.forEach((i=>{i.uuid===e.target.id&&(i.x=$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(t.style.left),i.y=$4f8e5fb2dc7a6f8f$export$526bad2e66ad9dff(t.style.top))})),this.divLeft=null,this.divTop=null,t.style.zIndex=this.defaultZIndex)}getLabels(){return this.labels}activeLabel(){const e=document.querySelector(".label-item-active").id;return this.labels.find((t=>t.uuid===e))}setImage(e){this.removeAllLabels(),this.imageUrl=e,this.init()}setLabels(e){this.labels=e,this.init()}getImageInfo(){return this.imageInfo}}var $5bbdaa7df4002674$export$2e2bcd8739ae039=$5bbdaa7df4002674$var$SimpleImageLabel;